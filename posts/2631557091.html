<!DOCTYPE html><html lang="zh-CN"><head><style type="text/css">.douban-card-block{display:flex;justify-content:center;align-items:center;width:100%;max-height:400px}.douban-card{display:flex;margin:30px 10px;padding:15px;border-radius:15px;position:relative;justify-content:center;align-items:center;overflow:hidden;color:#faebd7;text-decoration:none}.douban-card:hover{text-decoration:none}.douban-card-bgimg{position:absolute;width:115%;height:115%;filter:blur(15px) brightness(.6);background-size:100%;background-position:center;background-repeat:no-repeat}.douban-card-img{position:relative;height:130px;width:80px;background-size:100%;background-position:center;background-repeat:no-repeat}.douban-card-left:hover .douban-card-img{filter:blur(5px) brightness(.6);transform:perspective(800px) rotateX(180deg)}.douban-card-left .douban-card-img{transition:all .5s ease}.douban-card-left{position:relative;display:flex;flex-direction:column;align-items:center}.douban-card-left .douban-card-status{height:130px;width:80px;text-align:center;font-weight:700;position:absolute;left:0;top:30%;transform:rotateX(180deg);backface-visibility:hidden;transition:all .5s ease}.douban-card-left:hover .douban-card-status{transform:perspective(800px) rotateX(0)}.douban-card-right{position:relative;display:flex;flex-direction:column;margin-left:12px;font-size:16px;font-family:"Courier New",Courier,monospace;line-height:1.3;color:#faebd7}.douban-card-item{margin-top:4px}</style><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222" media="(prefers-color-scheme: light)"><meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 7.3.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&family=Roboto+Mono:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&family=PT+Mono:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css"><script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script><script class="next-config" data-name="main" type="application/json">{"hostname":"www.shaogui.life","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.22.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"flat","show_result":true},"fold":{"enable":true,"height":200},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script><meta name="description" content="本文介绍使用 LLM 时，利用存储记忆，给予 LLM 感知聊天历史的能力"><meta property="og:type" content="article"><meta property="og:title" content="langChain 基础 03 - 存储"><meta property="og:url" content="https://www.shaogui.life/posts/2631557091.html"><meta property="og:site_name" content="年轻人起来冲"><meta property="og:description" content="本文介绍使用 LLM 时，利用存储记忆，给予 LLM 感知聊天历史的能力"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2024-09-18T10:50:01.000Z"><meta property="article:modified_time" content="2025-01-18T10:50:08.854Z"><meta property="article:author" content="Shaogui"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://www.shaogui.life/posts/2631557091.html"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://www.shaogui.life/posts/2631557091.html","path":"posts/2631557091.html","title":"langChain 基础 03 - 存储"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>langChain 基础 03 - 存储 | 年轻人起来冲</title><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css"><link rel="alternate" href="/atom.xml" title="年轻人起来冲" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">年轻人起来冲</p><i class="logo-line"></i></a></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="搜索" role="button"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">77</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">70</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">544</span></a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close" role="button"><i class="fa fa-times-circle"></i></span></div><div class="search-result-container"><div class="search-result-icon"><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AF%B9%E8%AF%9D%E7%BC%93%E5%AD%98%E5%82%A8%E5%AD%98-conversationbuffermemory"><span class="nav-number">1.</span> <span class="nav-text">对话缓存储存 (ConversationBufferMemory）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AF%B9%E8%AF%9D%E7%BC%93%E5%AD%98%E7%AA%97%E5%8F%A3%E5%82%A8%E5%AD%98-conversationbufferwindowmemory"><span class="nav-number">2.</span> <span class="nav-text">对话缓存窗口储存 (ConversationBufferWindowMemory）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AF%B9%E8%AF%9D%E4%BB%A4%E7%89%8C%E7%BC%93%E5%AD%98%E5%82%A8%E5%AD%98-conversationtokenbuffermemory"><span class="nav-number">3.</span> <span class="nav-text">对话令牌缓存储存 (ConversationTokenBufferMemory）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AF%B9%E8%AF%9D%E6%91%98%E8%A6%81%E7%BC%93%E5%AD%98%E5%82%A8%E5%AD%98-conversationsummarybuffermemory"><span class="nav-number">4.</span> <span class="nav-text">对话摘要缓存储存 (ConversationSummaryBufferMemory）</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="Shaogui" src="/images/avatar-2023.png"><p class="site-author-name" itemprop="name">Shaogui</p><div class="site-description" itemprop="description">害怕失败是本能，勇敢面对才是本事</div></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">544</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">70</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">77</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/WuShaogui" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;WuShaogui" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a> </span><span class="links-of-author-item"><a href="https://www.zhihu.com/people/mu-zhi-zhi-tian" title="知乎 → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;mu-zhi-zhi-tian" rel="noopener me" target="_blank"><i class="fab fa-zhihu fa-fw"></i>知乎</a></span></div><div class="cc-license animated" itemprop="license"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a></div></div></div><div class="back-to-top animated" role="button" aria-label="返回顶部"><i class="fa fa-arrow-up"></i> <span>0%</span></div></div><div class="sidebar-inner sidebar-blogroll"><div class="links-of-blogroll animated"><div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i> 链接</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"><a href="http://manaai.cn/" title="http:&#x2F;&#x2F;manaai.cn&#x2F;" rel="noopener" target="_blank">神力AI</a></li></ul></div></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.shaogui.life/posts/2631557091.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar-2023.png"><meta itemprop="name" content="Shaogui"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="年轻人起来冲"><meta itemprop="description" content="害怕失败是本能，勇敢面对才是本事"></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="langChain 基础 03 - 存储 | 年轻人起来冲"><meta itemprop="description" content=""></span><header class="post-header"><h1 class="post-title" itemprop="name headline">langChain 基础 03 - 存储</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2024-09-18 18:50:01" itemprop="dateCreated datePublished" datetime="2024-09-18T18:50:01+08:00">2024-09-18</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2025-01-18 18:50:08" itemprop="dateModified" datetime="2025-01-18T18:50:08+08:00">2025-01-18</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/2-%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">2-深度学习</span></a> </span>， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/2-%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/LLM%E5%BC%80%E5%8F%91%E5%B7%A5%E7%A8%8B%E5%B8%88%E6%8C%87%E5%8D%97/" itemprop="url" rel="index"><span itemprop="name">LLM开发工程师指南</span></a> </span>， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/2-%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/LLM%E5%BC%80%E5%8F%91%E5%B7%A5%E7%A8%8B%E5%B8%88%E6%8C%87%E5%8D%97/LangChain/" itemprop="url" rel="index"><span itemprop="name">LangChain</span></a> </span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv"><span class="post-meta-item-icon"><i class="far fa-eye"></i> </span><span class="post-meta-item-text">阅读次数：</span> <span id="busuanzi_value_page_pv"></span> </span><span class="post-meta-break"></span> <span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>7.3k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>7 分钟</span></span></div></div></header><div class="post-body" itemprop="articleBody"><p>本文介绍使用 LLM 时，利用存储记忆，给予 LLM 感知聊天历史的能力</p><span id="more"></span><p>在提示词内容中，通过传递对话记录给 llm，使得 llm 拥有短期记忆，但是不能每次提问都把以前的对话手动传递给 llm，这太麻烦，本章通过 langchian 的存储组件解决这个问题<br>Langchain 提供多种模块来管理这些 "短暂记忆"，包括：</p><ul><li>对话缓存储存 (ConversationBufferMemory）</li><li>对话缓存窗口储存 (ConversationBufferWindowMemory）</li><li>对话令牌缓存储存 (ConversationTokenBufferMemory）</li><li>对话摘要缓存储存 (ConversationSummaryBufferMemory）</li></ul><h2 id="对话缓存储存-conversationbuffermemory"><a class="markdownIt-Anchor" href="#对话缓存储存-conversationbuffermemory"></a> 对话缓存储存 (ConversationBufferMemory）</h2><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.chains <span class="keyword">import</span> ConversationChain</span><br><span class="line"><span class="keyword">from</span> langchain.memory <span class="keyword">import</span> ConversationBufferMemory</span><br><span class="line"><span class="comment"># 这里我们将参数temperature设置为0.0，从而减少生成答案的随机性。</span></span><br><span class="line"><span class="comment"># 如果你想要每次得到不一样的有新意的答案，可以尝试增大该参数。</span></span><br><span class="line">memory = ConversationBufferMemory()</span><br><span class="line"><span class="comment"># 新建一个 ConversationChain Class 实例</span></span><br><span class="line"><span class="comment"># verbose参数设置为True时，程序会输出更详细的信息，以提供更多的调试或运行时信息。</span></span><br><span class="line"><span class="comment"># 相反，当将verbose参数设置为False时，程序会以更简洁的方式运行，只输出关键的信息。</span></span><br><span class="line">conversation = ConversationChain(llm=llm, memory = memory, verbose=<span class="literal">True</span>)</span><br><span class="line">conversation.predict(<span class="built_in">input</span>=<span class="string">"你好, 我叫皮皮鲁"</span>)</span><br></pre></td></tr></tbody></table></figure><figure class="highlight markdown"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="quote">&gt; Entering new ConversationChain chain...</span></span><br><span class="line">   Prompt after formatting:</span><br><span class="line">   The following is a friendly conversation between a human and an AI. The AI is talkative and provides lots of specific details from its context. If the AI does not know the answer to a question, it truthfully says it does not know.</span><br><span class="line">   Current conversation:</span><br><span class="line">   Human: 你好, 我叫皮皮鲁</span><br><span class="line">   AI:</span><br><span class="line">   &gt; Finished chain.</span><br><span class="line">   '你好，皮皮鲁！很高兴认识你。我可以称呼你皮皮鲁吗？我听说你是一个非常勇敢的小朋友，有很多奇妙的经历呢。你有什么有趣的故事或者冒险想和我分享的吗？'</span><br></pre></td></tr></tbody></table></figure><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conversation.predict(<span class="built_in">input</span>=<span class="string">"1+1等于多少？"</span>)</span><br></pre></td></tr></tbody></table></figure><figure class="highlight markdown"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="quote">&gt; Entering new ConversationChain chain...</span></span><br><span class="line">   Prompt after formatting:</span><br><span class="line">   The following is a friendly conversation between a human and an AI. The AI is talkative and provides lots of specific details from its context. If the AI does not know the answer to a question, it truthfully says it does not know.</span><br><span class="line">   Current conversation:</span><br><span class="line">   Human: 你好, 我叫皮皮鲁</span><br><span class="line">   AI: 你好，皮皮鲁！很高兴认识你。我可以称呼你皮皮鲁吗？我听说你是一个非常勇敢的小朋友，有很多奇妙的经历呢。你有什么有趣的故事或者冒险想和我分享的吗？</span><br><span class="line">   Human: 1+1等于多少？</span><br><span class="line">   AI:</span><br><span class="line">   &gt; Finished chain.</span><br><span class="line">   '1+1等于2哦！这是一个基本的加法运算。你在数学方面学得真快呀，皮皮鲁！接下来，我们可以聊聊你的冒险故事了，你最喜欢哪次冒险呢？有没有什么有趣的事情想要分享？'</span><br></pre></td></tr></tbody></table></figure><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conversation.predict(<span class="built_in">input</span>=<span class="string">"我叫什么名字？"</span>)</span><br></pre></td></tr></tbody></table></figure><figure class="highlight markdown"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="quote">&gt; Entering new ConversationChain chain...</span></span><br><span class="line">   Prompt after formatting:</span><br><span class="line">   The following is a friendly conversation between a human and an AI. The AI is talkative and provides lots of specific details from its context. If the AI does not know the answer to a question, it truthfully says it does not know.</span><br><span class="line">   Current conversation:</span><br><span class="line">   Human: 你好, 我叫皮皮鲁</span><br><span class="line">   AI: 你好，皮皮鲁！很高兴认识你。我可以称呼你皮皮鲁吗？我听说你是一个非常勇敢的小朋友，有很多奇妙的经历呢。你有什么有趣的故事或者冒险想和我分享的吗？</span><br><span class="line">   Human: 1+1等于多少？</span><br><span class="line">   AI: 1+1等于2哦！这是一个基本的加法运算。你在数学方面学得真快呀，皮皮鲁！接下来，我们可以聊聊你的冒险故事了，你最喜欢哪次冒险呢？有没有什么有趣的事情想要分享？</span><br><span class="line">   Human: 我叫什么名字？</span><br><span class="line">   AI:</span><br><span class="line">   &gt; Finished chain.</span><br><span class="line">   '你叫皮皮鲁哦！看来你已经告诉我你的名字了。你有什么有趣的冒险故事或者想知道的东西想和我一起探索吗？我在这里等着听你的故事呢！'</span><br></pre></td></tr></tbody></table></figure><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看缓存</span></span><br><span class="line"><span class="built_in">print</span>(memory.buffer) </span><br></pre></td></tr></tbody></table></figure><figure class="highlight markdown"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Human: 你好, 我叫皮皮鲁</span><br><span class="line">   AI: 你好，皮皮鲁！很高兴认识你。我可以称呼你皮皮鲁吗？我听说你是一个非常勇敢的小朋友，有很多奇妙的经历呢。你有什么有趣的故事或者冒险想和我分享的吗？</span><br><span class="line">Human: 1+1等于多少？</span><br><span class="line">   AI: 1+1等于2哦！这是一个基本的加法运算。你在数学方面学得真快呀，皮皮鲁！接下来，我们可以聊聊你的冒险故事了，你最喜欢哪次冒险呢？有没有什么有趣的事情想要分享？</span><br><span class="line">   Human: 我叫什么名字？</span><br><span class="line">   AI: 你叫皮皮鲁哦！看来你已经告诉我你的名字了。你有什么有趣的冒险故事或者想知道的东西想和我一起探索吗？我在这里等着听你的故事呢！</span><br></pre></td></tr></tbody></table></figure><h2 id="对话缓存窗口储存-conversationbufferwindowmemory"><a class="markdownIt-Anchor" href="#对话缓存窗口储存-conversationbufferwindowmemory"></a> 对话缓存窗口储存 (ConversationBufferWindowMemory）</h2><p>随着对话变得越来越长，所需的内存量也变得非常长，对话缓存窗口储存只保留一个窗口大小的对话。它只使用最近的 n 次交互。这可以用于保持最近交互的滑动窗口，以便缓冲区不会过大</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.memory <span class="keyword">import</span> ConversationBufferWindowMemory</span><br><span class="line"><span class="comment"># k=1表明只保留一个对话记忆</span></span><br><span class="line">memory = ConversationBufferWindowMemory(k=<span class="number">1</span>)  </span><br><span class="line">memory.save_context({<span class="string">"input"</span>: <span class="string">"你好，我叫皮皮鲁"</span>}, {<span class="string">"output"</span>: <span class="string">"你好啊，我叫鲁西西"</span>})</span><br><span class="line">memory.save_context({<span class="string">"input"</span>: <span class="string">"很高兴和你成为朋友！"</span>}, {<span class="string">"output"</span>: <span class="string">"是的，让我们一起去冒险吧！"</span>})</span><br><span class="line">memory = ConversationBufferWindowMemory(k=<span class="number">1</span>)</span><br><span class="line">conversation = ConversationChain(llm=llm, memory=memory, verbose=<span class="literal">False</span>  )</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"第一轮对话："</span>)</span><br><span class="line"><span class="built_in">print</span>(conversation.predict(<span class="built_in">input</span>=<span class="string">"你好, 我叫皮皮鲁"</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"第二轮对话："</span>)</span><br><span class="line"><span class="built_in">print</span>(conversation.predict(<span class="built_in">input</span>=<span class="string">"1+1等于多少？"</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"第三轮对话："</span>)</span><br><span class="line"><span class="built_in">print</span>(conversation.predict(<span class="built_in">input</span>=<span class="string">"我叫什么名字？"</span>))</span><br></pre></td></tr></tbody></table></figure><figure class="highlight markdown"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">第一轮对话：</span><br><span class="line">   你好，皮皮鲁，很高兴认识你！我可以叫你皮皮鲁吗？我叫Qwen，是来自阿里云的助手。你喜欢阅读冒险故事吗？我是说，你是否喜欢《皮皮鲁总动员》系列的故事呢？</span><br><span class="line">   第二轮对话：</span><br><span class="line">   1+1等于2哦！这是一个基本的加法运算。你对数学很有兴趣吗？如果有的问题不懂的话，尽管问我，我会耐心给你解释的。顺便说一句，关于《皮皮鲁总动员》系列的故事，我也很感兴趣呢！里面有很多有趣的冒险故事和角色呢。</span><br><span class="line">   第三轮对话：</span><br><span class="line">   你没有在对话中告诉我你的名字哦。不过没关系，你可以告诉我你想叫什么名字。如果有关于《皮皮鲁总动员》或其他任何问题，都可以和我分享。我可以帮你解答疑惑或一起探讨有趣的话题！如果你愿意的话，也可以告诉我你的名字是什么。</span><br></pre></td></tr></tbody></table></figure><h2 id="对话令牌缓存储存-conversationtokenbuffermemory"><a class="markdownIt-Anchor" href="#对话令牌缓存储存-conversationtokenbuffermemory"></a> 对话令牌缓存储存 (ConversationTokenBufferMemory）</h2><p>以上是限制聊天论次，这里是限制 token 数量，内存将限制保存的 token 数量。如果字符数量超出指定数目，它会切掉这个对话的早期部分以保留与最近的交流相对应的字符数量，但不超过字符限制</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.llms <span class="keyword">import</span> OpenAI</span><br><span class="line"><span class="keyword">from</span> langchain.memory <span class="keyword">import</span> ConversationTokenBufferMemory</span><br><span class="line">memory = ConversationTokenBufferMemory(llm=llm, max_token_limit=<span class="number">30</span>)</span><br><span class="line">memory.save_context({<span class="string">"input"</span>: <span class="string">"朝辞白帝彩云间，"</span>}, {<span class="string">"output"</span>: <span class="string">"千里江陵一日还。"</span>})</span><br><span class="line">memory.save_context({<span class="string">"input"</span>: <span class="string">"两岸猿声啼不住，"</span>}, {<span class="string">"output"</span>: <span class="string">"轻舟已过万重山。"</span>})</span><br><span class="line">memory.load_memory_variables({})</span><br></pre></td></tr></tbody></table></figure><blockquote><p>{‘history’: ‘AI: 轻舟已过万重山。’}</p></blockquote><h2 id="对话摘要缓存储存-conversationsummarybuffermemory"><a class="markdownIt-Anchor" href="#对话摘要缓存储存-conversationsummarybuffermemory"></a> 对话摘要缓存储存 (ConversationSummaryBufferMemory）</h2><p>直接保存聊天记录，可能内容太多了，每次保存前使用 LLM 总结一下聊天记录，存储总结内容即可</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain.chains <span class="keyword">import</span> ConversationChain</span><br><span class="line"><span class="keyword">from</span> langchain.chat_models <span class="keyword">import</span> ChatOpenAI</span><br><span class="line"><span class="keyword">from</span> langchain.memory <span class="keyword">import</span> ConversationSummaryBufferMemory</span><br><span class="line"><span class="comment"># 创建一个长字符串</span></span><br><span class="line">schedule = <span class="string">"在八点你和你的产品团队有一个会议。 \</span></span><br><span class="line"><span class="string">你需要做一个PPT。 \</span></span><br><span class="line"><span class="string">上午9点到12点你需要忙于LangChain。\</span></span><br><span class="line"><span class="string">Langchain是一个有用的工具，因此你的项目进展的非常快。\</span></span><br><span class="line"><span class="string">中午，在意大利餐厅与一位开车来的顾客共进午餐 \</span></span><br><span class="line"><span class="string">走了一个多小时的路程与你见面，只为了解最新的 AI。 \</span></span><br><span class="line"><span class="string">确保你带了笔记本电脑可以展示最新的 LLM 样例."</span></span><br><span class="line">memory = ConversationSummaryBufferMemory(llm=llm, max_token_limit=<span class="number">100</span>)</span><br><span class="line">memory.save_context({<span class="string">"input"</span>: <span class="string">"你好，我叫皮皮鲁"</span>}, {<span class="string">"output"</span>: <span class="string">"你好啊，我叫鲁西西"</span>})</span><br><span class="line">memory.save_context({<span class="string">"input"</span>: <span class="string">"很高兴和你成为朋友！"</span>}, {<span class="string">"output"</span>: <span class="string">"是的，让我们一起去冒险吧！"</span>})</span><br><span class="line">memory.save_context({<span class="string">"input"</span>: <span class="string">"今天的日程安排是什么？"</span>}, {<span class="string">"output"</span>: <span class="string">f"<span class="subst">{schedule}</span>"</span>})</span><br><span class="line">conversation = ConversationChain(llm=llm, memory=memory, verbose=<span class="literal">True</span>)</span><br><span class="line">conversation.predict(<span class="built_in">input</span>=<span class="string">"展示什么样的样例最好呢？"</span>)</span><br></pre></td></tr></tbody></table></figure><figure class="highlight markdown"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="quote">&gt; Entering new ConversationChain chain...</span></span><br><span class="line">   Prompt after formatting:</span><br><span class="line">   The following is a friendly conversation between a human and an AI. The AI is talkative and provides lots of specific details from its context. If the AI does not know the answer to a question, it truthfully says it does not know.</span><br><span class="line">   Current conversation:</span><br><span class="line">   System: Hello, User. You introduced yourself as Pipilu. How can I assist you today? The AI greets the user and introduces itself as Lu Xi Xi. They become friends and decide to go on an adventure together. The user asks about their schedule for the day, which includes a meeting with their product team at 8 AM where they need to prepare a PPT. From 9 AM to 12 PM, they are focused on LangChain, as it is a useful tool that will help progress their project quickly. They have a business lunch at an Italian restaurant with a customer who drove for over an hour just to discuss the latest AI developments and brought a laptop to showcase new LLM examples.</span><br><span class="line">   Human: 展示什么样的样例最好呢？</span><br><span class="line">   AI:</span><br><span class="line">   Token indices sequence length is longer than the specified maximum sequence length for this model (1135 &gt; 1024). Running this sequence through the model will result in indexing errors</span><br><span class="line">   &gt; Finished chain.</span><br><span class="line">   '展示样例的时候，选择那些能够清晰地体现LangChain如何帮助解决实际问题的案例会很好。可以考虑以下几个方面来挑选和准备样例：\n\n1. <span class="strong">**具体业务场景**</span>：选择一个具体的业务场景或者项目，比如自动化的数据处理、实时数据分析等。这样可以让对方更直观地看到LangChain的实际应用价值。\n\n2. <span class="strong">**技术亮点**</span>：突出展示LangChain在这些场景中的关键优势和技术特性，例如快速构建复杂的数据流系统、提高数据处理效率等。\n\n3. <span class="strong">**对比分析**</span>：如果可能的话，可以准备一些基于传统方法和使用LangChain后的效果对比分析。这样不仅能够直观地展示LangChain的优势，还能增加说服力。\n\n4. <span class="strong">**实际案例研究**</span>：如果有现成的客户成功案例或者内部项目案例，可以详细讲述这些案例中的问题、解决方案以及最终结果。这不仅可以提供具体的操作指南，还能增强对方对LangChain的信任感和兴趣。\n\n5. <span class="strong">**未来展望**</span>：简要介绍LangChain在未来的潜在应用场景和发展趋势，激发客户的想象空间。\n\n例如，在展示时，你可以先概述一下今天将要讨论的主题，比如“今天的会议我们将探讨如何利用LangChain技术来加速我们的数据分析项目。首先，我将通过一个具体的案例来详细说明该技术的应用方式及其带来的好处。”\n\n这样既能确保内容的全面性和实用性，也能让对方保持兴趣并积极参与到对话中来。希望这些建议对你有所帮助！'</span><br></pre></td></tr></tbody></table></figure><p>这段脚本展示了如何使用 Langchain 库中的不同记忆管理模块来处理和存储对话历史，以便在与 LLM 交互时保持短期记忆。通过示例代码，分别介绍了 ConversationBufferMemory、ConversationBufferWindowMemory、ConversationTokenBufferMemory 和 ConversationSummaryBufferMemory 四种不同的记忆管理方式，用于应对不同类型的需求和场景</p></div><footer class="post-footer"><div class="reward-container"><div>请我一杯咖啡吧！</div><button>赞赏</button><div class="post-reward"><div><img src="/images/wechatpay.png" alt="Shaogui 微信"> <span>微信</span></div><div><img src="/images/alipay.png" alt="Shaogui 支付宝"> <span>支付宝</span></div></div></div><div class="post-copyright"><ul><li class="post-copyright-author"><strong>本文作者： </strong>Shaogui</li><li class="post-copyright-link"><strong>本文链接：</strong> <a href="https://www.shaogui.life/posts/2631557091.html" title="langChain 基础 03 - 存储">https://www.shaogui.life/posts/2631557091.html</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class="followme"><span>欢迎关注我的其它发布渠道</span><div class="social-list"><div class="social-item"><a target="_blank" class="social-link" href="https://www.zhihu.com/people/mu-zhi-zhi-tian"><span class="icon"><i class="fab fa-zhihu"></i> </span><span class="label">知乎</span></a></div><div class="social-item"><a target="_blank" class="social-link" href="/atom.xml"><span class="icon"><i class="fa fa-rss"></i> </span><span class="label">RSS</span></a></div></div></div><div class="post-nav"><div class="post-nav-item"><a href="/posts/2592298305.html" rel="prev" title="langChain 基础 02 - 提示词"><i class="fa fa-angle-left"></i> langChain 基础 02 - 提示词</a></div><div class="post-nav-item"><a href="/posts/2898179741.html" rel="next" title="langChain 基础 04 - 模型链">langChain 基础 04 - 模型链 <i class="fa fa-angle-right"></i></a></div></div></footer></article></div><div class="comments utterances-container"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; 2016 – <span itemprop="copyrightYear">2025</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">Shaogui</span></div><div class="wordcount"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-chart-line"></i> </span><span>站点总字数：</span> <span title="站点总字数">1.9m</span> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-coffee"></i> </span><span>站点阅读时长 &asymp;</span> <span title="站点阅读时长">28:48</span></span></div><div class="busuanzi-count"><span class="post-meta-item" id="busuanzi_container_site_uv"><span class="post-meta-item-icon"><i class="fa fa-user"></i> </span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span> </span></span><span class="post-meta-item" id="busuanzi_container_site_pv"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动</div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div><div class="sidebar-dimmer"></div><div class="reading-progress-bar"></div><a href="https://github.com/WuShaogui" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script><script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script><script src="/js/third-party/search/local-search.js"></script><script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"neutral","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/11.4.0/mermaid.min.js","integrity":"sha256-G8ouPAnw4zzMbnAenHnVz6h9XpKbNdOkrqTh7AadyHs="}}</script><script src="/js/third-party/tags/mermaid.js"></script><script src="/js/third-party/pace.js"></script><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script><script src="/js/third-party/math/mathjax.js"></script><script class="next-config" data-name="utterances" type="application/json">{"enable":true,"repo":"WuShaogui/wushaogui.github.io","issue_term":"pathname","theme":"github-light"}</script><script src="/js/third-party/comments/utterances.js"></script></body></html>