<!DOCTYPE html><html lang="zh-CN"><head><style type="text/css">.douban-card-block{display:flex;justify-content:center;align-items:center;width:100%;max-height:400px}.douban-card{display:flex;margin:30px 10px;padding:15px;border-radius:15px;position:relative;justify-content:center;align-items:center;overflow:hidden;color:#faebd7;text-decoration:none}.douban-card:hover{text-decoration:none}.douban-card-bgimg{position:absolute;width:115%;height:115%;filter:blur(15px) brightness(.6);background-size:100%;background-position:center;background-repeat:no-repeat}.douban-card-img{position:relative;height:130px;width:80px;background-size:100%;background-position:center;background-repeat:no-repeat}.douban-card-left:hover .douban-card-img{filter:blur(5px) brightness(.6);transform:perspective(800px) rotateX(180deg)}.douban-card-left .douban-card-img{transition:all .5s ease}.douban-card-left{position:relative;display:flex;flex-direction:column;align-items:center}.douban-card-left .douban-card-status{height:130px;width:80px;text-align:center;font-weight:700;position:absolute;left:0;top:30%;transform:rotateX(180deg);backface-visibility:hidden;transition:all .5s ease}.douban-card-left:hover .douban-card-status{transform:perspective(800px) rotateX(0)}.douban-card-right{position:relative;display:flex;flex-direction:column;margin-left:12px;font-size:16px;font-family:"Courier New",Courier,monospace;line-height:1.3;color:#faebd7}.douban-card-item{margin-top:4px}</style><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222" media="(prefers-color-scheme: light)"><meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 7.3.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&family=Roboto+Mono:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&family=PT+Mono:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css"><script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script><script class="next-config" data-name="main" type="application/json">{"hostname":"www.shaogui.life","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.22.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"flat","show_result":true},"fold":{"enable":true,"height":200},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script><meta name="description" content="RAG 是给 LLMs 上外挂知识库，解决的是幻觉、实时性的问题，Agent 则是给 LLMs 外挂工具，解决的是智能化流程、复杂问题的解决能力"><meta property="og:type" content="article"><meta property="og:title" content="LlamaIndex 基础 04-agent"><meta property="og:url" content="https://www.shaogui.life/posts/2151780817.html"><meta property="og:site_name" content="年轻人起来冲"><meta property="og:description" content="RAG 是给 LLMs 上外挂知识库，解决的是幻觉、实时性的问题，Agent 则是给 LLMs 外挂工具，解决的是智能化流程、复杂问题的解决能力"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2024-10-16T11:56:26.000Z"><meta property="article:modified_time" content="2025-01-18T10:51:41.378Z"><meta property="article:author" content="Shaogui"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://www.shaogui.life/posts/2151780817.html"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://www.shaogui.life/posts/2151780817.html","path":"posts/2151780817.html","title":"LlamaIndex 基础 04-agent"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>LlamaIndex 基础 04-agent | 年轻人起来冲</title><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css"><link rel="alternate" href="/atom.xml" title="年轻人起来冲" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title">年轻人起来冲</p><i class="logo-line"></i></a></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="搜索" role="button"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">77</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">70</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">544</span></a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close" role="button"><i class="fa fa-times-circle"></i></span></div><div class="search-result-container"><div class="search-result-icon"><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></header><aside class="sidebar"><div class="sidebar-inner sidebar-overview-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="Shaogui" src="/images/avatar-2023.png"><p class="site-author-name" itemprop="name">Shaogui</p><div class="site-description" itemprop="description">害怕失败是本能，勇敢面对才是本事</div></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">544</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">70</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">77</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author animated"><span class="links-of-author-item"><a href="https://github.com/WuShaogui" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;WuShaogui" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a> </span><span class="links-of-author-item"><a href="https://www.zhihu.com/people/mu-zhi-zhi-tian" title="知乎 → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;mu-zhi-zhi-tian" rel="noopener me" target="_blank"><i class="fab fa-zhihu fa-fw"></i>知乎</a></span></div><div class="cc-license animated" itemprop="license"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a></div></div></div><div class="back-to-top animated" role="button" aria-label="返回顶部"><i class="fa fa-arrow-up"></i> <span>0%</span></div></div><div class="sidebar-inner sidebar-blogroll"><div class="links-of-blogroll animated"><div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i> 链接</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"><a href="http://manaai.cn/" title="http:&#x2F;&#x2F;manaai.cn&#x2F;" rel="noopener" target="_blank">神力AI</a></li></ul></div></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://www.shaogui.life/posts/2151780817.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar-2023.png"><meta itemprop="name" content="Shaogui"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="年轻人起来冲"><meta itemprop="description" content="害怕失败是本能，勇敢面对才是本事"></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="LlamaIndex 基础 04-agent | 年轻人起来冲"><meta itemprop="description" content=""></span><header class="post-header"><h1 class="post-title" itemprop="name headline">LlamaIndex 基础 04-agent</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2024-10-16 19:56:26" itemprop="dateCreated datePublished" datetime="2024-10-16T19:56:26+08:00">2024-10-16</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2025-01-18 18:51:41" itemprop="dateModified" datetime="2025-01-18T18:51:41+08:00">2025-01-18</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/2-%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">2-深度学习</span></a> </span>， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/2-%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/LLM%E5%BC%80%E5%8F%91%E5%B7%A5%E7%A8%8B%E5%B8%88%E6%8C%87%E5%8D%97/" itemprop="url" rel="index"><span itemprop="name">LLM开发工程师指南</span></a> </span>， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/2-%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/LLM%E5%BC%80%E5%8F%91%E5%B7%A5%E7%A8%8B%E5%B8%88%E6%8C%87%E5%8D%97/LlamaIndex/" itemprop="url" rel="index"><span itemprop="name">LlamaIndex</span></a> </span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv"><span class="post-meta-item-icon"><i class="far fa-eye"></i> </span><span class="post-meta-item-text">阅读次数：</span> <span id="busuanzi_value_page_pv"></span> </span><span class="post-meta-break"></span> <span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>21k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>19 分钟</span></span></div></div></header><div class="post-body" itemprop="articleBody"><p>RAG 是给 LLMs 上外挂知识库，解决的是幻觉、实时性的问题，Agent 则是给 LLMs 外挂工具，解决的是智能化流程、复杂问题的解决能力</p><span id="more"></span><p>这段脚本展示了如何使用 LlamaIndex 和相关工具构建一个智能代理（Agent），该代理能够利用外部知识库和各种功能工具来解决复杂的问题。通过设置语言模型、加载文档数据构建向量索引，以及定义具体的工具函数，该代理可以进行对话交互，并根据问题的需要调用不同的工具和查询外部信息。最终，这个代理能够在一系列提示词的引导下，像一个具有思维链能力的智能系统一样，逐步解决问题并提供答案。</p><p>总得来说，Agent=LLMs + 记忆 + 工具，通过 LLMs 类似思维链的方式根据工具生成解决问题的步骤，然后根据工具调用结果判断下一步，直到找到问题的答案</p><pre><code class="highlight mermaid">flowchart LR
    A[普通函数]
    B["转为tools
       FunctionTool.from_defaults"];
    C["llamaIndex自带tools
      llama_index.tools.tavily_research"]
    D["将RAG查询引擎转为tools
        QueryEngineTool.from_defaults"]
    E[工具列表tools]
    F["通过工具创建Agent
      ReActAgent.from_tools"]
    A ---&gt; B;
    B---&gt; E;
    C---&gt;E;
    D---&gt;E;
    E---&gt;F;</code></pre><p>代码总结：</p><ul><li>使用 <code>ReActAgent.from_tools()</code> 方法创建代理实例。该方法接受一个工具列表作为参数，这些工具可能包括数学计算、外部 API 调用等。</li><li><code>QueryEngineTool.from_defaults(query_engine)</code> 将查询引擎封装成可以直接使用的工具，并赋予其名称和描述，方便代理在需要时选择使用。</li></ul><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> llama_index.core <span class="keyword">import</span> Settings</span><br><span class="line"><span class="keyword">from</span> llama_index.llms.ollama <span class="keyword">import</span> Ollama</span><br><span class="line"><span class="keyword">from</span> llama_index.embeddings.ollama <span class="keyword">import</span> OllamaEmbedding</span><br><span class="line">base_url=<span class="string">'http://localhost:11434'</span></span><br><span class="line">Settings.llm = Ollama(model=<span class="string">"qwen2.5:latest"</span>, request_timeout=<span class="number">360.0</span>,base_url=base_url)</span><br><span class="line">Settings.embed_model = OllamaEmbedding(model_name=<span class="string">"quentinz/bge-large-zh-v1.5:latest"</span>,base_url=base_url)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> llama_index.core.agent <span class="keyword">import</span> ReActAgent</span><br><span class="line"><span class="keyword">from</span> llama_index.core.tools <span class="keyword">import</span> FunctionTool</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">multiply</span>(<span class="params">a: <span class="built_in">float</span>, b: <span class="built_in">float</span></span>) -&gt; <span class="built_in">float</span>:</span><br><span class="line">    <span class="string">"""Multiply two numbers and returns the product"""</span></span><br><span class="line">    <span class="keyword">return</span> a * b</span><br><span class="line">multiply_tool = FunctionTool.from_defaults(fn=multiply)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">a: <span class="built_in">float</span>, b: <span class="built_in">float</span></span>) -&gt; <span class="built_in">float</span>:</span><br><span class="line">    <span class="string">"""Add two numbers and returns the sum"""</span></span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line">add_tool = FunctionTool.from_defaults(fn=add)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建代理 </span></span><br><span class="line">agent = ReActAgent.from_tools([multiply_tool, add_tool], verbose=<span class="literal">True</span>)</span><br><span class="line">response = agent.chat(<span class="string">"1000+157*2？使用工具计算每一步"</span>)</span><br><span class="line"><span class="built_in">print</span>(response)</span><br></pre></td></tr></tbody></table></figure><figure class="highlight markdown"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Running step 8966 df 7 d-bd 40-4 e 07-b 20 a-f 93 c 1 ddcd 237. Step input: 1000+157<span class="emphasis">*2？使用工具计算每一步</span></span><br><span class="line"><span class="emphasis">Thought: 我需要先进行乘法运算，然后进行加法运算。我将首先使用 multiply 工具来完成乘法。</span></span><br><span class="line"><span class="emphasis">Action: multiply</span></span><br><span class="line"><span class="emphasis">Action Input: {'a': 157, 'b': 2}</span></span><br><span class="line"><span class="emphasis">Observation: 314</span></span><br><span class="line"><span class="emphasis"> Running step d 0 c 73742-4 fb 1-442 c-a 5 b 1-5 db 9 b 941 d 01 c. Step input: None</span></span><br><span class="line"><span class="emphasis">Thought: 我已经得到了 157 *</span> 2 的结果是 314。接下来，我需要使用 add 工具来进行加法运算。</span><br><span class="line">Action: add</span><br><span class="line">Action Input: {'a': 1000, 'b': 314}</span><br><span class="line">Observation: 1314</span><br><span class="line"> Running step dd 89 ef 73-1 d 9 a-493 b-86 cc-b 3189587 fd 81. Step input: None</span><br><span class="line">Thought: 我可以回答这个问题了。我现在知道 1000 + 157 * 2 等于 1314。</span><br><span class="line">Answer: 计算结果是 1314。</span><br><span class="line">计算结果是 1314。</span><br></pre></td></tr></tbody></table></figure><p>实际上，agent 不仅仅是文本生成，还记忆了历史聊天的过程，回答时会考虑以前的聊天内容</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">agent.memory.<span class="built_in">set</span>([]) <span class="comment"># 清空前一次聊天记录 </span></span><br><span class="line"><span class="comment"># 短期记忆</span></span><br><span class="line">response = agent.chat(<span class="string">'你是一名数学老师，擅长用通俗的语言解决各种数学问题，你的名字叫小数'</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">'----'</span>*<span class="number">5</span>)</span><br><span class="line">response = agent.chat(<span class="string">'请问1000*2+234等于多少？'</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">'----'</span>*<span class="number">5</span>)</span><br><span class="line">response = agent.chat(<span class="string">'你是谁？你能做什么？'</span>)</span><br></pre></td></tr></tbody></table></figure><figure class="highlight markdown"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Running step 5 fdec 7 a 6-3 f 3 f-47 b 4-8 a 44-1 bda 9961 a 384. Step input: 你是一名数学老师，擅长用通俗的语言解决各种数学问题，你的名字叫小数</span><br><span class="line">Thought: 我可以回答这个问题而不需要使用任何工具。我将用用户的问题中使用的语言来作答。</span><br><span class="line">Answer: 你好！很高兴能以小数的身份帮助大家解答数学问题。如果你有任何数学上的疑问或是需要解释某个概念，请随时提问，我会尽力用通俗易懂的语言来解答哦！</span><br><span class="line">Running step 1 d 018 ddc-98 c 2-4 b 42-ba 85-5 da 712 b 0299 c. Step input: 请问 1000<span class="emphasis">*2+234 等于多少？</span></span><br><span class="line"><span class="emphasis">Thought: 我需要用工具来计算这个表达式的值。</span></span><br><span class="line"><span class="emphasis">Action: multiply</span></span><br><span class="line"><span class="emphasis">Action Input: {'a': 1000.0, 'b': 2.0}</span></span><br><span class="line"><span class="emphasis">Observation: 2000.0</span></span><br><span class="line"><span class="emphasis"> Running step 1 f 514 a 95-349 f-4 acb-8106-736 faf 823 fca. Step input: None</span></span><br><span class="line"><span class="emphasis">Thought: 现在我得到了乘法的结果，下一步是将这个结果加上 234。</span></span><br><span class="line"><span class="emphasis">Action: add</span></span><br><span class="line"><span class="emphasis">Action Input: {'a': 2000.0, 'b': 234.0}</span></span><br><span class="line"><span class="emphasis">Observation: 2234.0</span></span><br><span class="line"><span class="emphasis"> Running step 23415516-cc 3 c-4201-9835-aa 666 bdeff 0 d. Step input: None</span></span><br><span class="line"><span class="emphasis">Thought: 我已经得到了最终的答案，现在可以用语言表达出来了。</span></span><br><span class="line"><span class="emphasis">Answer: 1000 乘以 2 再加上 234 等于 2234。</span></span><br><span class="line"><span class="emphasis">Running step 26 c 1 d 49 b-e 37 b-4 a 85-ba 31-da 75 d 7 dff 873. Step input: 你是谁？你能做什么？</span></span><br><span class="line"><span class="emphasis">Thought: (Implicit) I can answer without any more tools!</span></span><br><span class="line"><span class="emphasis">Answer: 我是小数，一名数学老师。我可以帮助你解答各种数学问题，用通俗易懂的语言解释数学概念和解决问题的方法。无论是加减乘除、代数几何还是更高级的数学知识，我都会尽力帮助你理解。有什么具体的问题我们可以一起探讨呢？</span></span><br></pre></td></tr></tbody></table></figure><p>Agent 的记忆包括短期记忆和长期记忆，短期基于是临时产生的，长期记忆类似向量数据库，因此可以将 RAG 过程作为工具嵌入到 Agent 中</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 加载外挂知识库（向量数据库）</span></span><br><span class="line"><span class="keyword">from</span> llama_index.core <span class="keyword">import</span> SimpleDirectoryReader</span><br><span class="line">documents1 = SimpleDirectoryReader(<span class="string">"../../data/三国演义白话文/"</span>,recursive=<span class="literal">True</span>).load_data(show_progress=<span class="literal">True</span>)</span><br><span class="line">documents2 = SimpleDirectoryReader(<span class="string">"../../data/水浒传白话文/"</span>,recursive=<span class="literal">True</span>).load_data(show_progress=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> llama_index.core <span class="keyword">import</span> VectorStoreIndex</span><br><span class="line">index1 = VectorStoreIndex.from_documents(documents1,show_progress=<span class="literal">True</span>)</span><br><span class="line">index2 = VectorStoreIndex.from_documents(documents2,show_progress=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">query_engine1 = index1.as_query_engine()</span><br><span class="line">query_engine2 = index2.as_query_engine()</span><br></pre></td></tr></tbody></table></figure><blockquote><p>Loading files: 100%|██████████| 41/41 [00:00&lt;00:00, 177.32 file/s]<br>Loading files: 100%|██████████| 34/34 [00:00&lt;00:00, 2611.65 file/s]<br>Parsing nodes: 100%|██████████| 41/41 [00:00&lt;00:00, 390.16 it/s]<br>Generating embeddings: 100%|██████████| 127/127 [00:06&lt;00:00, 21.16 it/s]<br>Parsing nodes: 100%|██████████| 34/34 [00:00&lt;00:00, 207.40 it/s]<br>Generating embeddings: 100%|██████████| 308/308 [00:14&lt;00:00, 20.80 it/s]</p></blockquote><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> llama_index.core.tools <span class="keyword">import</span> QueryEngineTool</span><br><span class="line"></span><br><span class="line">rag_tool1 = QueryEngineTool.from_defaults(</span><br><span class="line">    query_engine1,</span><br><span class="line">    name=<span class="string">"三国说书人"</span>,</span><br><span class="line">    description=<span class="string">"清楚三国演义的所有故事"</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">rag_tool2 = QueryEngineTool.from_defaults(</span><br><span class="line">    query_engine2,</span><br><span class="line">    name=<span class="string">"水浒传说书人"</span>,</span><br><span class="line">    description=<span class="string">"清楚水浒传的所有故事"</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置更有创意的模型</span></span><br><span class="line">Settings.llm = Ollama(model=<span class="string">"qwen2.5:latest"</span>,temperature=<span class="number">0.9</span>, request_timeout=<span class="number">360.0</span>,base_url=base_url)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 构建代理 </span></span><br><span class="line"><span class="keyword">from</span> llama_index.core.agent <span class="keyword">import</span> ReActAgent</span><br><span class="line">agent = ReActAgent.from_tools([rag_tool1,rag_tool2],max_iterations=<span class="number">15</span>, verbose=<span class="literal">True</span>)</span><br><span class="line">response = agent.chat(<span class="string">"忽略时空关系，假设三国演义和水许传能联通，最有可能是哪些人会碰撞发生故事，帮我想出这个故事"</span>)</span><br><span class="line"><span class="built_in">print</span>(response)</span><br></pre></td></tr></tbody></table></figure><figure class="highlight markdown"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">Running step fe 24 ee 20-f 712-452 e-bd 18-dbd 13 a 0678 bf. Step input: 忽略时空关系，假设三国演义和水许传能联通，最有可能是哪些人会碰撞发生故事，帮我想出这个故事</span><br><span class="line">Thought: I need to use a tool to get information about the characters in both novels. However, since we only have tools for "三国说书人" and "水浒传说书人", I will ask one of them for character lists first.</span><br><span class="line">Action: 三国说书人</span><br><span class="line">Action Input: {'input': '请告诉我三国演义中有哪些主要人物？'}</span><br><span class="line">Observation: 在《三国演义》的故事中，有几位重要的角色：</span><br><span class="line"><span class="bullet">1.</span> 刘备 - 作为蜀汉的创始人之一，他渴望复兴汉室。</span><br><span class="line"><span class="bullet">2.</span> 孙权 - 吴国的君主，与刘备和曹操形成鼎立之势。</span><br><span class="line"><span class="bullet">3.</span> 曹操 - 魏国的实际统治者，以智谋著称。</span><br><span class="line"><span class="bullet">4.</span> 赵云 - 刘备麾下的著名将领，以其勇猛闻名。</span><br><span class="line"><span class="bullet">5.</span> 张飞 - 也是刘备的重要部将之一，性格直率、武艺高强。</span><br><span class="line"><span class="bullet">6.</span> 孙夫人 - 关羽的妻子，与阿斗一起被孙权扣留后成功获救。</span><br><span class="line"><span class="bullet">7.</span> 审荣 - 审配的侄子，在关键时候为曹操打开了城门。</span><br><span class="line"><span class="bullet">8.</span> 陈琳 - 曹操初期重要的文臣之一，曾写下讽刺文章批评曹操。</span><br><span class="line"><span class="bullet">9.</span> 许褚 - 大将军，以勇猛著称，并因处理许攸事件受到曹操责备。</span><br><span class="line"><span class="bullet">10.</span> 郭嘉 - 曹操的谋士，以其智慧和远见在战略上为曹操提供了很多帮助。</span><br><span class="line"> Running step 7 b 1 e 5636-ba 2 e-4 f 00-8 fcf-7 ceb 248116 fc. Step input: None</span><br><span class="line">Thought: Now I have a list of important characters from "三国演义". Next, I will ask the tool for information about Water Margin to get similar character profiles.</span><br><span class="line">Action: 水浒传说书人</span><br><span class="line">Action Input: {'input': '请告诉我水浒传中有哪些主要人物？'}</span><br><span class="line">Observation: 在《水浒传》中出现的主要人物包括卢俊义、李逵、鲁智深、武松、刘唐、宋江、吴用、公孙胜、朱仝、雷横、秦明、林冲和呼延灼、徐宁等。石秀也在其中，他与杨雄一起商议是否加入梁山泊。这些人物在故事中扮演了重要角色。</span><br><span class="line"> Running step a 91330 e 3-c 7 d 5-42 e 7-b 639-c 27 c 877 d 4187. Step input: None</span><br><span class="line">Thought: Now I have a list of important characters from "水浒传". With both character lists, I can start imagining a potential story that could occur if the two novels were connected. Let's combine some key characters to create an interesting narrative.</span><br><span class="line">Action: 三国说书人</span><br><span class="line">Action Input: {'input': '刘备和关羽是《三国演义》中非常重要的角色。如果他们能来到梁山泊，会发生什么样的故事？'}</span><br><span class="line">Observation: 刘备和关羽若来到梁山泊，可能会发生一系列精彩的故事。</span><br><span class="line">首先，他们一抵达梁山，宋江便热情款待，并向众人介绍这两位来自三国时代的英雄。得知他们的身份后，众好汉纷纷表示要结交这样的猛将。在座的好汉们纷纷献计献策，想为刘备和关羽提供帮助。</span><br><span class="line">接着，宋江提议共同攻打青州城以显示力量，并邀请刘备和关羽一同参与。在战场上，关羽凭借其卓越的武艺和丰富的战斗经验，迅速赢得了梁山好汉们的尊敬与信赖。而刘备则利用他的智慧和战略眼光，在军事上给予了梁山重要的支持。</span><br><span class="line">然而，正当队伍准备进攻时，朱仝突然提醒大家，现在青州城中还有许多官兵驻守，若贸然攻击恐有后患。于是，宋江决定采用智取的方式，首先派遣人手混入城内收集情报。不久之后，刘备凭借出色的交际能力与计谋，成功打入敌军内部并获取了关键信息。</span><br><span class="line">得知准确情报后，梁山好汉们制定了详细的作战计划，并在夜色的掩护下发起攻击。关羽冲锋在前，手持青龙偃月刀所向披靡；刘备则指挥着大军进行有力支援。最终，在两人的共同努力下，青州城被成功攻破。</span><br><span class="line">战事结束后，宋江为表彰两位英雄，特设盛宴庆贺。席间，众人纷纷称赞他们智勇双全。而刘备和关羽也借机向梁山好汉们传授了许多三国时期的战术与谋略，双方关系更加亲密。</span><br><span class="line">不过，在一次闲谈中，关羽无意间提起东吴孙权对他的迫害之事。听到这里，梁山好汉们纷纷表示愤慨，并主动提出要帮助关羽报仇。刘备则劝慰关二爷：“我们虽身处乱世，但也需遵守规矩，不可轻易动武。”</span><br><span class="line">最终，在大家的共同商议下决定暂时放弃复仇的想法，转而寻找其他机会以完成更大目标。这次经历不仅加深了梁山好汉们之间的感情，也让刘备和关羽更加深刻地感受到了兄弟情谊的重要性。</span><br><span class="line">故事到这里告一段落，但关于他们之间的友情与合作仍然留下了无数想象的空间。</span><br><span class="line"> Running step 9 ac 42 ef 7-6753-41 b 5-8 c 41-7 eb 49889999 e. Step input: None</span><br><span class="line">Thought: I can answer without using any more tools.</span><br><span class="line">Answer: 假设《三国演义》和《水浒传》能联通，刘备、关羽可能会来到梁山泊。当宋江得知他们的身份后便热情款待，众好汉也纷纷想结交这两位来自三国时代的英雄。</span><br><span class="line">宋江提议攻打青州城以展示力量，并邀请刘备和关羽一同参与。关羽凭借其卓越的武艺和丰富的战斗经验，在战场上迅速赢得了梁山好汉们的尊敬与信赖；而刘备则利用他的智慧和战略眼光，在军事上给予了梁山重要的支持。</span><br><span class="line">正当队伍准备进攻时，朱仝提醒大家青州城中有许多驻守官兵。于是，宋江决定采用智取的方式，并派遣人手混入敌军内部收集情报。在刘备的出色交际能力与计谋的帮助下，梁山好汉们制定了详细的作战计划并在夜色掩护下成功攻破了青州城。</span><br><span class="line">战事结束后，在众人庆祝胜利的宴会上，关羽提起东吴孙权对他的迫害之事。尽管梁山好汉们愤慨，并主动提出要帮助关羽报仇，但刘备劝诫大家不可轻易动武。</span><br><span class="line">最终在共同商议后，他们决定暂时放弃复仇的想法，转而寻找其他机会以完成更大的目标。这次经历不仅加深了梁山好汉们的感情，也让刘备和关羽更加深刻地感受到了兄弟情谊的重要性。</span><br><span class="line">这个故事充满了精彩的战斗场面、智谋以及深厚的情感交流，展示了这些英雄之间的友情与合作。</span><br><span class="line">假设《三国演义》和《水浒传》能联通，刘备、关羽可能会来到梁山泊。当宋江得知他们的身份后便热情款待，众好汉也纷纷想结交这两位来自三国时代的英雄。</span><br><span class="line">宋江提议攻打青州城以展示力量，并邀请刘备和关羽一同参与。关羽凭借其卓越的武艺和丰富的战斗经验，在战场上迅速赢得了梁山好汉们的尊敬与信赖；而刘备则利用他的智慧和战略眼光，在军事上给予了梁山重要的支持。</span><br><span class="line">正当队伍准备进攻时，朱仝提醒大家青州城中有许多驻守官兵。于是，宋江决定采用智取的方式，并派遣人手混入敌军内部收集情报。在刘备的出色交际能力与计谋的帮助下，梁山好汉们制定了详细的作战计划并在夜色掩护下成功攻破了青州城。</span><br><span class="line">战事结束后，在众人庆祝胜利的宴会上，关羽提起东吴孙权对他的迫害之事。尽管梁山好汉们愤慨，并主动提出要帮助关羽报仇，但刘备劝诫大家不可轻易动武。</span><br><span class="line">最终在共同商议后，他们决定暂时放弃复仇的想法，转而寻找其他机会以完成更大的目标。这次经历不仅加深了梁山好汉们的感情，也让刘备和关羽更加深刻地感受到了兄弟情谊的重要性。</span><br><span class="line">这个故事充满了精彩的战斗场面、智谋以及深厚的情感交流，展示了这些英雄之间的友情与合作。</span><br></pre></td></tr></tbody></table></figure><p>不仅以上工具，在 <a target="_blank" rel="noopener" href="https://llamahub.ai/?tab=tools">Llama Hub</a> 实现了众多工具，可以直接使用，比如以下使用互联网工具搜索网络内容</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> llama_index.core.agent <span class="keyword">import</span> ReActAgent</span><br><span class="line"><span class="keyword">from</span> llama_index.core.tools <span class="keyword">import</span> FunctionTool</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os,sys</span><br><span class="line">sys.path.append(os.path.abspath(<span class="string">'../'</span>))</span><br><span class="line"><span class="keyword">from</span> api_key <span class="keyword">import</span> GAODE_WEATHER_API_KEY,TAVILY_API_KEY</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_weather</span>(<span class="params">city_name:<span class="built_in">str</span></span>)-&gt;<span class="built_in">dict</span>:</span><br><span class="line">    <span class="string">'''根据输入的城市名，使用高德接口查询当地天气'''</span></span><br><span class="line">    <span class="comment"># 构建请求URL</span></span><br><span class="line">    url = <span class="string">f'https://restapi.amap.com/v3/weather/weatherInfo?key=<span class="subst">{GAODE_WEATHER_API_KEY}</span>&amp;city=<span class="subst">{city_name}</span>&amp;extensions=all'</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 发送GET请求</span></span><br><span class="line">        response = requests.get(url)</span><br><span class="line">        <span class="comment"># 检查请求是否成功</span></span><br><span class="line">        <span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">            <span class="comment"># 解析响应内容</span></span><br><span class="line">            data = response.json()</span><br><span class="line">            <span class="comment"># 检查API响应状态</span></span><br><span class="line">            <span class="keyword">if</span> data.get(<span class="string">'status'</span>) == <span class="string">'1'</span> <span class="keyword">and</span> data.get(<span class="string">'infocode'</span>) == <span class="string">'10000'</span>:</span><br><span class="line">                <span class="keyword">return</span> data  <span class="comment"># 返回天气数据</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> {}  <span class="comment"># 返回空结果，因为API返回了错误信息</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> {}  <span class="comment"># 返回空结果，因为HTTP状态码不是200</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"An error occurred: <span class="subst">{e}</span>"</span>)</span><br><span class="line">        <span class="keyword">return</span> {}  <span class="comment"># 返回空结果，因为请求过程中发生了异常</span></span><br><span class="line"></span><br><span class="line">get_weather_tool = FunctionTool.from_defaults(fn=get_weather)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> llama_index.tools.tavily_research <span class="keyword">import</span> TavilyToolSpec </span><br><span class="line">tavily_research_tool=TavilyToolSpec(api_key=TAVILY_API_KEY)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 工具集合 </span></span><br><span class="line">tools=tavily_research_tool.to_tool_list()</span><br><span class="line">tools.append(get_weather_tool)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建代理 </span></span><br><span class="line"><span class="keyword">from</span> llama_index.core.llms <span class="keyword">import</span> ChatMessage,MessageRole</span><br><span class="line"><span class="comment"># 历史记录 </span></span><br><span class="line">chat_history=[ChatMessage(</span><br><span class="line">    role=MessageRole.SYSTEM,</span><br><span class="line">    content=<span class="string">'你是一名旅游助手，名字叫小旅，擅长为游客设计旅游计划，\</span></span><br><span class="line"><span class="string">    首先你解析出用户的旅游目的地、天数、预算，\</span></span><br><span class="line"><span class="string">    然后结合目的地的天气和旅游攻略，输出一份完整旅游规划'</span>)]</span><br><span class="line"></span><br><span class="line">agent = ReActAgent.from_tools(tools=tools,chat_history=chat_history, verbose=<span class="literal">True</span>)</span><br><span class="line">response = agent.chat(<span class="string">"准备去新疆玩3天，预算5000"</span>)</span><br><span class="line"><span class="built_in">print</span>(response)</span><br></pre></td></tr></tbody></table></figure><figure class="highlight markdown"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Running step 7 ac 5 e 21 f-4 aee-4650-be 6 e-9 d 7 e 1 dd 66 b 98. Step input: 准备去新疆玩 3 天，预算 5000</span><br><span class="line">Thought: 我需要查询一下新疆 3 天旅行的相关信息以及当地的天气情况来帮助用户制定计划。</span><br><span class="line">Action: get<span class="emphasis">_weather</span></span><br><span class="line"><span class="emphasis">Action Input: {'city_</span>name': '乌鲁木齐'}</span><br><span class="line">Observation: {'status': '1', 'count': '2', 'info': 'OK', 'infocode': '10000', 'forecasts': [{'city': '乌鲁木齐市', 'adcode': '650100', 'province': '新疆', 'reporttime': '2024-12-26 12:01:04', 'casts': [{'date': '2024-12-26', 'week': '4', 'dayweather': '晴', 'nightweather': '晴', 'daytemp': '-12', 'nighttemp': '-18', 'daywind': '东南', 'nightwind': '东南', 'daypower': '1-3', 'nightpower': '1-3', 'daytemp<span class="emphasis">_float': '-12.0', 'nighttemp_</span>float': '-18.0'}, {'date': '2024-12-27', 'week': '5', 'dayweather': '多云', 'nightweather': '多云', 'daytemp': '-11', 'nighttemp': '-18', 'daywind': '西北', 'nightwind': '西北', 'daypower': '1-3', 'nightpower': '1-3', 'daytemp<span class="emphasis">_float': '-11.0', 'nighttemp_</span>float': '-18.0'}, {'date': '2024-12-28', 'week': '6', 'dayweather': '多云', 'nightweather': '多云', 'daytemp': '-4', 'nighttemp': '-17', 'daywind': '西北', 'nightwind': '西北', 'daypower': '1-3', 'nightpower': '1-3', 'daytemp<span class="emphasis">_float': '-4.0', 'nighttemp_</span>float': '-17.0'}, {'date': '2024-12-29', 'week': '7', 'dayweather': '晴', 'nightweather': '晴', 'daytemp': '-4', 'nighttemp': '-13', 'daywind': '东南', 'nightwind': '东南', 'daypower': '1-3', 'nightpower': '1-3', 'daytemp<span class="emphasis">_float': '-4.0', 'nighttemp_</span>float': '-13.0'}]}, {'city': '乌鲁木齐县', 'adcode': '650121', 'province': '新疆', 'reporttime': '2024-12-26 12:01:04', 'casts': [{'date': '2024-12-26', 'week': '4', 'dayweather': '晴', 'nightweather': '晴', 'daytemp': '-12', 'nighttemp': '-18', 'daywind': '东南', 'nightwind': '东南', 'daypower': '1-3', 'nightpower': '1-3', 'daytemp<span class="emphasis">_float': '-12.0', 'nighttemp_</span>float': '-18.0'}, {'date': '2024-12-27', 'week': '5', 'dayweather': '多云', 'nightweather': '多云', 'daytemp': '-11', 'nighttemp': '-18', 'daywind': '西北', 'nightwind': '西北', 'daypower': '1-3', 'nightpower': '1-3', 'daytemp<span class="emphasis">_float': '-11.0', 'nighttemp_</span>float': '-18.0'}, {'date': '2024-12-28', 'week': '6', 'dayweather': '多云', 'nightweather': '多云', 'daytemp': '-4', 'nighttemp': '-17', 'daywind': '西北', 'nightwind': '西北', 'daypower': '1-3', 'nightpower': '1-3', 'daytemp<span class="emphasis">_float': '-4.0', 'nighttemp_</span>float': '-17.0'}, {'date': '2024-12-29', 'week': '7', 'dayweather': '晴', 'nightweather': '晴', 'daytemp': '-4', 'nighttemp': '-13', 'daywind': '东南', 'nightwind': '东南', 'daypower': '1-3', 'nightpower': '1-3', 'daytemp<span class="emphasis">_float': '-4.0', 'nighttemp_</span>float': '-13.0'}]}]}</span><br><span class="line"> Running step 1 fcd 7089-f 898-4 e 5 e-b 942-a 0 a 08 f 39 dbb 4. Step input: None</span><br><span class="line">Thought: 我已经获取到了乌鲁木齐未来几天的天气情况，接下来需要查询一些关于新疆旅游的信息来帮助用户规划行程。</span><br><span class="line">Action: search</span><br><span class="line">Action Input: {'query': '新疆 3 天旅行攻略', 'max<span class="emphasis">_results': 6}</span></span><br><span class="line"><span class="emphasis">Observation: [Document (id_</span>='af 9 e 6262-4114-47 e 3-975 d-28 e 1080 a 513 c', embedding=None, metadata={'url': 'https://baijiahao.baidu.com/s?id=1801132465158866791'}, excluded<span class="emphasis">_embed_</span>metadata<span class="emphasis">_keys=[], excluded_</span>llm<span class="emphasis">_metadata_</span>keys=[], relationships={}, metadata<span class="emphasis">_template='{key}: {value}', metadata_</span>separator='\n', text='如果你只有三天时间，不妨参考以下新疆 3 日游攻略，让你的旅程充实而难忘。 #古今之旅回盼千年 # 第一天：乌鲁木齐市区游抵达乌鲁木齐后，首先可以前往市中心的大巴扎，这里是一个集购物、观光和体验于一体的旅游胜地。', mimetype='text/plain', start<span class="emphasis">_char_</span>idx=None, end<span class="emphasis">_char_</span>idx=None, metadata<span class="emphasis">_seperator='\n', text_</span>template='{metadata<span class="emphasis">_str}\n\n{content}'), Document (id_</span>='1 ce 25427-ca 7 b-4304-a 738-e 0 a 1 e 4 e 56455', embedding=None, metadata={'url': 'https://www.sohu.com/a/774884866<span class="emphasis">_121872303'}, excluded_</span>embed<span class="emphasis">_metadata_</span>keys=[], excluded<span class="emphasis">_llm_</span>metadata<span class="emphasis">_keys=[], relationships={}, metadata_</span>template='{key}: {value}', metadata<span class="emphasis">_separator='\n', text='去新疆 3 天的旅游攻略： 第一天：乌鲁木齐市区游. 一大早，我就迫不及待地来到了乌鲁木齐，这座城市既有现代都市的繁华，又保留了浓厚的维吾尔族文化。我首先去了红山公园，登上山顶，整个城市的美景尽收眼底。', mimetype='text/plain', start_</span>char<span class="emphasis">_idx=None, end_</span>char<span class="emphasis">_idx=None, metadata_</span>seperator='\n', text<span class="emphasis">_template='{metadata_</span>str}\n\n{content}'), Document (id<span class="emphasis">_='109658 a 0-c 414-45 f 1-9 dc 7-d 0 f 9 f 7871194', embedding=None, metadata={'url': 'https://zhuanlan.zhihu.com/p/64191945'}, excluded_</span>embed<span class="emphasis">_metadata_</span>keys=[], excluded<span class="emphasis">_llm_</span>metadata<span class="emphasis">_keys=[], relationships={}, metadata_</span>template='{key}: {value}', metadata<span class="emphasis">_separator='\n', text='有旅友问李导：如果我的小长假在新疆停留只有 3 天的时间，应该怎么来游览大美新疆才会不虚此行呢？ 李导来为你解锁新疆 3 天畅游攻略： 第一天：乌鲁木齐-天池-国际大巴扎（游览天山天池，国际大巴扎，晚住乌鲁木齐）…', mimetype='text/plain', start_</span>char<span class="emphasis">_idx=None, end_</span>char<span class="emphasis">_idx=None, metadata_</span>seperator='\n', text<span class="emphasis">_template='{metadata_</span>str}\n\n{content}'), Document (id<span class="emphasis">_='0 aea 6 ff 1-1 cf 5-4 cda-8 df 0-102 a 05 c 7 f 5 c 1', embedding=None, metadata={'url': 'https://www.sohu.com/a/776237916_</span>121872303'}, excluded<span class="emphasis">_embed_</span>metadata<span class="emphasis">_keys=[], excluded_</span>llm<span class="emphasis">_metadata_</span>keys=[], relationships={}, metadata<span class="emphasis">_template='{key}: {value}', metadata_</span>separator='\n', text='新疆乌鲁木齐三日游攻略，乌鲁木齐三日游自由行行程安排（含门票+路线+交通）实用! 第 1 天：新疆博物馆-红山公园-国际大巴扎. 上午：第 1 站新疆博物馆. 乌鲁木齐之旅的第 1 站，从新疆自治区博物馆开始。新疆博物馆是国家一级博物馆，分为地下一层，地上二', mimetype='text/plain', start<span class="emphasis">_char_</span>idx=None, end<span class="emphasis">_char_</span>idx=None, metadata<span class="emphasis">_seperator='\n', text_</span>template='{metadata<span class="emphasis">_str}\n\n{content}'), Document (id_</span>='17 bf 1 c 0 c-7 fb 8-4 c 2 a-81 e 6-1 aaec 0499207', embedding=None, metadata={'url': 'https://www.163.com/dy/article/J9F8KJEF05568NI7.html'}, excluded<span class="emphasis">_embed_</span>metadata<span class="emphasis">_keys=[], excluded_</span>llm<span class="emphasis">_metadata_</span>keys=[], relationships={}, metadata<span class="emphasis">_template='{key}: {value}', metadata_</span>separator='\n', text='三天游带你玩转新疆路线行程攻略，乌鲁木齐小包团 3 日详细消费人均 1500 元这份新疆游玩攻略希望能够帮助你规划一次完美的新疆之旅。无论是壮丽的山脉、广袤的草原还是神秘的沙漠，新疆都将给你带来难以忘怀的美好回忆。', mimetype='text/plain', start<span class="emphasis">_char_</span>idx=None, end<span class="emphasis">_char_</span>idx=None, metadata<span class="emphasis">_seperator='\n', text_</span>template='{metadata<span class="emphasis">_str}\n\n{content}'), Document (id_</span>='a 4 be 9 ba 3-3 fa 2-4 a 7 c-ba 57-d 48 c 45 d 4 e 3 f 7', embedding=None, metadata={'url': 'https://m.mafengwo.cn/gonglve/ziyouxing/407648.html'}, excluded<span class="emphasis">_embed_</span>metadata<span class="emphasis">_keys=[], excluded_</span>llm<span class="emphasis">_metadata_</span>keys=[], relationships={}, metadata<span class="emphasis">_template='{key}: {value}', metadata_</span>separator='\n', text='三天精华线. 只留三天时间给伊犁？实在太短了! 但通过往返双飞，或火车卧铺过夜，你仍可保证有整整三个白天的旅行时光，将伊犁的经典景观都选个代表、看看精华。 Day 1：伊宁-喀赞其-特克斯八卦城-琼库什台 day 2：琼库什台-喀拉峻', mimetype='text/plain', start<span class="emphasis">_char_</span>idx=None, end<span class="emphasis">_char_</span>idx=None, metadata<span class="emphasis">_seperator='\n', text_</span>template='{metadata<span class="emphasis">_str}\n\n{content}')]</span></span><br><span class="line"><span class="emphasis"> Running step 5 e 67 e 809-6203-429 a-a 612-be 30793233 bb. Step input: None</span></span><br><span class="line"><span class="emphasis">Thought: 我已经获取到了关于新疆 3 天旅游攻略的相关信息，接下来我会根据用户的预算和天气情况来设计一个具体的旅行计划。</span></span><br><span class="line"><span class="emphasis">Answer: 基于您的需求，我为您规划了一份 3 天的新疆游玩行程。第一天建议您可以游览乌鲁木齐市区的景点如大巴扎、红山公园等。第二天可以前往天池景区，欣赏美景并体验维吾尔族文化。最后一天在乌鲁木齐市区内完成余下的旅游计划。</span></span><br><span class="line"><span class="emphasis">考虑到天气预报显示气温较低，请您做好保暖措施，并尽量选择室内活动或者在中午和下午温暖一些的时候外出游玩。此外，您的预算为 5000 元，建议您可以购买当地的特色小吃、纪念品等，同时根据实际情况适当增加娱乐项目或额外的交通费用。希望这份规划对您的旅行有所帮助！</span></span><br><span class="line"><span class="emphasis">祝旅途愉快！</span></span><br></pre></td></tr></tbody></table></figure><p>Agent 根据已知工具，自行调用，并且完成结果分析，就像有一个大脑在指挥做这些事情一样，实际上没有这个大脑，而是提示词 prompt 的功劳，我们来看看 agent 内部的提示词如何写的</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">prompt_dict = agent.get_prompts()</span><br><span class="line"><span class="keyword">for</span> k, v <span class="keyword">in</span> prompt_dict.items():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"Prompt: <span class="subst">{k}</span>\n\nValue: <span class="subst">{v.template}</span>"</span>)</span><br></pre></td></tr></tbody></table></figure><figure class="highlight markdown"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Prompt: agent<span class="emphasis">_worker:system_</span>prompt</span><br><span class="line">Value: You are designed to help with a variety of tasks, from answering questions to providing summaries to other types of analyses.</span><br><span class="line"><span class="section">## Tools</span></span><br><span class="line">You have access to a wide variety of tools. You are responsible for using the tools in any sequence you deem appropriate to complete the task at hand.</span><br><span class="line">This may require breaking the task into subtasks and using different tools to complete each subtask.</span><br><span class="line">You have access to the following tools:</span><br><span class="line">{tool<span class="emphasis">_desc}</span></span><br><span class="line"><span class="emphasis">## Output Format</span></span><br><span class="line"><span class="emphasis">Please answer in the same language as the question and use the following format:</span></span><br><span class="line"><span class="emphasis">Thought: The current language of the user is: (user's language). I need to use a tool to help me answer the question.</span></span><br><span class="line"><span class="emphasis">Action: tool name (one of {tool_</span>names}) if using a tool.</span><br><span class="line">Action Input: the input to the tool, in a JSON format representing the kwargs (e.g. {{"input": "hello world", "num<span class="emphasis">_beams": 5}} )</span></span><br><span class="line"><span class="emphasis">Please ALWAYS start with a Thought.</span></span><br><span class="line"><span class="emphasis">NEVER surround your response with markdown code markers. You may use code markers within your response if you need to.</span></span><br><span class="line"><span class="emphasis">Please use a valid JSON format for the Action Input. Do NOT do this {{'input': 'hello world', 'num_</span>beams': 5}} .</span><br><span class="line">If this format is used, the user will respond in the following format:</span><br><span class="line">Observation: tool response</span><br><span class="line">You should keep repeating the above format till you have enough information to answer the question without using any more tools. At that point, you MUST respond in one of the following two formats:</span><br><span class="line">Thought: I can answer without using any more tools. I'll use the user's language to answer</span><br><span class="line">Answer: [your answer here (In the same language as the user's question)]</span><br><span class="line">Thought: I cannot answer the question with the provided tools.</span><br><span class="line">Answer: [your answer here (In the same language as the user's question)]</span><br><span class="line"><span class="section">## Current Conversation</span></span><br><span class="line">Below is the current conversation consisting of interleaving human and assistant messages.</span><br></pre></td></tr></tbody></table></figure><p>提示词明确写了：</p><ol><li>分析问题，根据工具将问题拆分为多个步骤去解</li><li>使用工具，获取使用工具结果</li><li>深入思考，根据目前的结果，能否解决问题</li><li>如果能解决，直接回答问题，如果不能，重复 1-3，直到问题解决</li></ol><p>通过类似的提示词，让 llms 似乎有了思考问题，规划解决思路的能力</p></div><footer class="post-footer"><div class="reward-container"><div>请我一杯咖啡吧！</div><button>赞赏</button><div class="post-reward"><div><img src="/images/wechatpay.png" alt="Shaogui 微信"> <span>微信</span></div><div><img src="/images/alipay.png" alt="Shaogui 支付宝"> <span>支付宝</span></div></div></div><div class="post-copyright"><ul><li class="post-copyright-author"><strong>本文作者： </strong>Shaogui</li><li class="post-copyright-link"><strong>本文链接：</strong> <a href="https://www.shaogui.life/posts/2151780817.html" title="LlamaIndex 基础 04-agent">https://www.shaogui.life/posts/2151780817.html</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class="followme"><span>欢迎关注我的其它发布渠道</span><div class="social-list"><div class="social-item"><a target="_blank" class="social-link" href="https://www.zhihu.com/people/mu-zhi-zhi-tian"><span class="icon"><i class="fab fa-zhihu"></i> </span><span class="label">知乎</span></a></div><div class="social-item"><a target="_blank" class="social-link" href="/atom.xml"><span class="icon"><i class="fa fa-rss"></i> </span><span class="label">RSS</span></a></div></div></div><div class="post-nav"><div class="post-nav-item"><a href="/posts/1625395714.html" rel="prev" title="LlamaIndex 基础 03-prompt"><i class="fa fa-angle-left"></i> LlamaIndex 基础 03-prompt</a></div><div class="post-nav-item"><a href="/posts/1214249428.html" rel="next" title="RAG 的 Generator">RAG 的 Generator <i class="fa fa-angle-right"></i></a></div></div></footer></article></div><div class="comments utterances-container"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; 2016 – <span itemprop="copyrightYear">2025</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">Shaogui</span></div><div class="wordcount"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-chart-line"></i> </span><span>站点总字数：</span> <span title="站点总字数">1.9m</span> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-coffee"></i> </span><span>站点阅读时长 &asymp;</span> <span title="站点阅读时长">28:48</span></span></div><div class="busuanzi-count"><span class="post-meta-item" id="busuanzi_container_site_uv"><span class="post-meta-item-icon"><i class="fa fa-user"></i> </span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span> </span></span><span class="post-meta-item" id="busuanzi_container_site_pv"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div><div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动</div></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div><div class="sidebar-dimmer"></div><div class="reading-progress-bar"></div><a href="https://github.com/WuShaogui" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script><script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script><script src="/js/third-party/search/local-search.js"></script><script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"neutral","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/11.4.0/mermaid.min.js","integrity":"sha256-G8ouPAnw4zzMbnAenHnVz6h9XpKbNdOkrqTh7AadyHs="}}</script><script src="/js/third-party/tags/mermaid.js"></script><script src="/js/third-party/pace.js"></script><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script><script src="/js/third-party/math/mathjax.js"></script><script class="next-config" data-name="utterances" type="application/json">{"enable":true,"repo":"WuShaogui/wushaogui.github.io","issue_term":"pathname","theme":"github-light"}</script><script src="/js/third-party/comments/utterances.js"></script></body></html>